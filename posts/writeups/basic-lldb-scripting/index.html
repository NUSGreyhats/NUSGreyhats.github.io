<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Basic LLDB Scripting | NUS Greyhats</title>
<meta name=keywords content="writeups">
<meta name=description content="Basic knowledge to get started with LLDB scripting">
<meta name=author content="daniellimws">
<link rel=canonical href=https://nusgreyhats.org/posts/writeups/basic-lldb-scripting/>
<meta name=google-site-verification content="XYZabc">
<meta name=yandex-verification content="XYZabc">
<meta name=msvalidate.01 content="XYZabc">
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel=stylesheet>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel=stylesheet>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.b268fb3bd1950526ba32df2898e8dfc3171f0fecdf09cd6945557b277f0eecf8.css integrity="sha256-smj7O9GVBSa6Mt8omOjfwxcfD+zfCc1pRVV7J38O7Pg=" rel="preload stylesheet" as=style>
<link rel=preload href=/greyhats-dark.png as=image>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://nusgreyhats.org/greyhats.png>
<link rel=icon type=image/png sizes=16x16 href=https://nusgreyhats.org/greyhats.png>
<link rel=icon type=image/png sizes=32x32 href=https://nusgreyhats.org/greyhats.png>
<link rel=apple-touch-icon href=https://nusgreyhats.org/greyhats.png>
<link rel=mask-icon href=https://nusgreyhats.org/greyhats.png>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.0">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Basic LLDB Scripting">
<meta property="og:description" content="Basic knowledge to get started with LLDB scripting">
<meta property="og:type" content="article">
<meta property="og:url" content="https://nusgreyhats.org/posts/writeups/basic-lldb-scripting/"><meta property="og:image" content="https://nusgreyhats.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-11-01T00:00:00+00:00">
<meta property="article:modified_time" content="2021-11-01T00:00:00+00:00"><meta property="og:site_name" content="NUS Greyhats">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://nusgreyhats.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E">
<meta name=twitter:title content="Basic LLDB Scripting">
<meta name=twitter:description content="Basic knowledge to get started with LLDB scripting">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nusgreyhats.org/posts/"},{"@type":"ListItem","position":2,"name":"Basic LLDB Scripting","item":"https://nusgreyhats.org/posts/writeups/basic-lldb-scripting/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Basic LLDB Scripting","name":"Basic LLDB Scripting","description":"Basic knowledge to get started with LLDB scripting","keywords":["writeups"],"articleBody":"During my internship, I reverse engineer macOS programs. So, I need a debugger.\nI am quite familiar with GDB, and there are nice extensions like GEF out there. However, Apple made it so difficult to compile a usable GDB on macOSâ€¦ ðŸ˜‘ We are pretty much forced to use LLDB (which I really donâ€™t like).\nAnyways, beggars canâ€™t be choosers, and vanilla GDB/LLDB is not really usable in the long run, so being able to use the scripting interface is very important. Similar to GDB, LLDB also has a Python scripting interface. Instead of .gdbinit, LLDB loads commands from .lldbinit during startup. There is a great lldbinit project that contains many custom commands which makes LLDB so much nicer to use, and I have a fork of it.\n(It is such a pain to even set breakpoints, vanilla LLDB is just not usable imo.)\nLLDB Architecture and Python Bindings Having the lldbinit extension is good. Being able to add my own custom commands is even better. To do so, I had to understand the architecture of the scripting interface.\nThe LLDB scripting interface is quite tidy. Everything is grouped into modules. Quoting the docs, here are less than half of the modules:\n SBAddress  A section + offset based address class.   SBBreakpoint  Represents a logical breakpoint and its associated settings.   SBBreakpointList  Proxy of C++ lldb::SBBreakpointList class   SBBreakpointLocation  Represents one unique instance (by address) of a logical breakpoint.   SBCommandInterpreter  SBCommandInterpreter handles/interprets commands for lldb.   SBCommandReturnObject  Represents a container which holds the result from command execution.    Feels like writing C++ but in Python. And the basic architecture is as follows:\nLLDB design: ------------| lldb - debugger - target - process - thread - frame(s) - thread - frame(s)  LLDB talks to the debugger object debugger holds a target target holds a process process holds multiple threads and lastly, each thread has one or more frames  With more details (quoting the docs):\n SBTarget: Represents the target program running under the debugger.  Gives information about the executable, process, modules, memory, breakpoints, etc Thereâ€™s a lot, check the docs   SBProcess: Represents the process associated with the target program.  Gives information about the process, memory Some overlap with the above, but this one doesnâ€™t have modules nor breakpoints Check the docs   SBThread: Represents a thread of execution.  Gives information about a thread, e.g. thread ID Exposes functions for stepping (step in, step over, etc) and suspending/resuming Contains stack frame(s) (according to docs, it is possible to have more than 1, but I always see just 1) Check out the docs   SBFrame: Represents one of the stack frames associated with a thread.  Gives information about a stack frame, e.g. registers, functions, symbols, disassembly, etc This is a really useful module because of the information it gives. Check out the docs    Now, some useful functions to access the objects mentioned above (defined by lldbinit):\n SBTarget - get_target() SBProcess - get_process() SBThread - get_thread() SBFrame - get_frame()  Yea, quite easy.\nCreate Custom Commands To define a new command, it is as simple as creating a function in lldbinit.py. For example, to create a command called newcmd:\ndef cmd_newcmd(debugger, command, result, _dict): args = command.split(' ') if len(args)  1: print('newcmd ') return ... Then, the function must be registered as a command in the __lldb_init_module method:\ndef __lldb_init_module(debugger, internal_dict): ... ci.HandleCommand(\"command script add -f lldbinit.cmd_newcmd newcmd\", res) ... The function name can be anything, but by convention all command functions in lldbinit go by cmd_.\nThe function arguments result and _dict might be useful but I donâ€™t use them. debugger is the LLDB debugger object mentioned earlier, and command is the exact command string entered by the user.\nWe can use the API listed above to obtain information about the target/process/thread/frame, or perform actions such as setting breakpoints, stepping through instructions, etc.\nExample 1: Reading Memory Hereâ€™s a simple command I wrote to print unicode strings from memory (similar to x/s but printing unicode strings).\ndef cmd_xu(debugger, command, result, _dict): args = command.split(' ') if len(args)  1: print('xu ') return addr = int(get_frame().EvaluateExpression(args[0]).GetValue(), 10) error = lldb.SBError() ended = False s = u'' offset = 0 while not ended: mem = get_target().GetProcess().ReadMemory(addr + offset, 100, error) for i in range(0, 100, 2): wc = mem[i+1]  8 | mem[i] s += chr(wc) if wc == 0: ended = True break offset += 100 print(s) Example 2: Alias It is also possible to make aliases for long commands. For example, an alias for disabling breakpoints, through the SBCommandInterpreter object obtained via the debugger.GetCommandInterpreter() method.\n# disable breakpoint number def cmd_bpd(debugger, command, result, dict): res = lldb.SBCommandReturnObject() debugger.GetCommandInterpreter().HandleCommand(\"breakpoint disable \" + command, res) print(res.GetOutput()) Example 3: Function Tracing Lastly, here is an example of a more complicated command I wrote to get the list of functions called by the target. This is useful when I am attaching LLDB to Safari, and want to know the functions in a library that were called by Safari when loading a webpage.\nFor example, to see the functions in CoreGraphics called when browsing Wikipedia:\n(lldbinit) cz CoreGraphics [+] Creating breakpoints for all symbols in CoreGraphics [+] Done creating breakpoints for all symbols in CoreGraphics 0x7fff2505d324: | CoreGraphics CGColorSpaceUsesExtendedRange |__ WebKit WebKit::ShareableBitmap::calculateBytesPerRow(WebCore::IntSize, WebKit::ShareableBitmap::Configuration const\u0026) 0x7fff2504a997: | CoreGraphics CGColorSpaceGetNumberOfComponents |__ QuartzCore CABackingStorePrepareUpdates_(CABackingStore*, unsigned long, unsigned long, unsigned int, unsigned int, unsigned int, unsigned long long, CA::GenericContext*, UpdateState*) 0x7fff250496fc: | CoreGraphics CGColorSpaceRetain |__ QuartzCore CA::CG::IOSurfaceDrawable::IOSurfaceDrawable(__IOSurface*, unsigned int, unsigned int, CGColorSpace*, int, int, unsigned int, unsigned int) 0x7fff2549cd24: | CoreGraphics CFRetain |__ CoreGraphics CGColorSpaceRetain 0x7fff2504971c: | CoreGraphics cs_retain_count |__ CoreFoundation _CFRetain 0x7fff2504e3d8: | CoreGraphics CGColorSpaceRelease |__ QuartzCore CABackingStorePrepareUpdates_(CABackingStore*, unsigned long, unsigned long, unsigned int, unsigned int, unsigned int, unsigned long long, CA::GenericContext*, UpdateState*) 0x7fff2505fdd1: | CoreGraphics CGSNewEmptyRegion |__ QuartzCore CABackingStorePrepareUpdates_(CABackingStore*, unsigned long, unsigned long, unsigned int, unsigned int, unsigned int, unsigned long long, CA::GenericContext*, UpdateState*) ... def cmd_cz(debugger, command, result, _dict): args = command.split(' ') if len(args)  1: print('cov ') return module_name = args[0] target = debugger.GetSelectedTarget() module = find_module_by_name(get_target(), module_name) # to keep track of the breakpoints set bpmap = {} print(\"[+] Creating breakpoints for all symbols in\", module_name) for symbol in module: sym_name = symbol.GetName() if sym_name.startswith(\"os\") or \"pthread\" in sym_name or \"lock\" in sym_name or \"operator\" in sym_name: continue address = symbol.GetStartAddress().GetLoadAddress(target) bp = target.BreakpointCreateByAddress(address) bpmap[address] = bp print(\"[+] Done creating breakpoints for all symbols in\", module_name) visited = [] while True: get_process().Continue() thread = get_thread() rip = int(str(get_frame().reg[\"rip\"].value), 16) if rip in visited: continue if rip not in bpmap.keys(): print(\"[+] Dead\") # crashed or something break # disable breakpoint after reaching it one time bpmap[rip].SetEnabled(False) print(hex(rip) + \":\") for i in range(2): frame = thread.GetFrameAtIndex(i) symbol = frame.GetSymbol() module = frame.GetModule().GetFileSpec().GetFilename() print(\"|\" + \"__\" * i, module, symbol.GetName()) In this example, I created a breakpoint using target.BreakpointCreateByAddress(address), by using the SBSymbol methods to get a functionâ€™s address in the process. I also used the lldbinit helper function find_module_by_name to get a SBModule object given a module name.\nThere were more unmentioned API calls used by this command, read the code to learn more if you are interested.\nThatâ€™s all. Hope you find this useful :D\nReferences:\n LLDB docs lldbinit  fork of peterâ€™s  fork of gdbinitâ€™s  fork of derokoâ€™s        ","wordCount":"1196","inLanguage":"en","datePublished":"2021-11-01T00:00:00Z","dateModified":"2021-11-01T00:00:00Z","author":{"@type":"Person","name":"daniellimws"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nusgreyhats.org/posts/writeups/basic-lldb-scripting/"},"publisher":{"@type":"Organization","name":"NUS Greyhats","logo":{"@type":"ImageObject","url":"https://nusgreyhats.org/greyhats.png"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://nusgreyhats.org/ accesskey=h title="NUS Greyhats (Alt + H)">
<img src=/greyhats-dark.png alt=logo aria-label=logo id=logo height=35>
<script>localStorage.getItem("pref-theme")==="light"?document.getElementById("logo").src="/greyhats.png":document.getElementById("logo").src="/greyhats-dark.png"</script>NUS Greyhats</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://nusgreyhats.org/team title="the team">
<span>the team</span>
</a>
</li>
<li>
<a href=https://nusgreyhats.org/secweds title=secweds>
<span>secweds</span>
</a>
</li>
<li>
<a href=https://nusgreyhats.org/resources/ title=resources>
<span>resources</span>
</a>
</li>
<li>
<a href=https://nusgreyhats.org/tags/ title=tags>
<span>tags</span>
</a>
</li>
<li>
<a href=https://nusgreyhats.org/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Basic LLDB Scripting
</h1>
<div class=post-description>
Basic knowledge to get started with LLDB scripting
</div>
<div class=post-meta>November 1, 2021&nbsp;Â·&nbsp;6 min&nbsp;Â·&nbsp;daniellimws&nbsp;|&nbsp;<a href=https://github.com/NUSGreyhats/NUSGreyhats.github.io/tree/master/content/posts/writeups/basic-lldb-scripting.md rel="noopener noreferrer" target=_blank>Suggest Changes</a>
</div>
</header>
<div class=post-content><p>During my internship, I reverse engineer macOS programs. So, I need a debugger.</p>
<p>I am quite familiar with GDB, and there are nice extensions like GEF out there. However, Apple made it so difficult to compile a usable GDB on macOS&mldr; ðŸ˜‘ We are pretty much forced to use LLDB (which I really don&rsquo;t like).</p>
<p>Anyways, beggars can&rsquo;t be choosers, and vanilla GDB/LLDB is not really usable in the long run, so being able to use the scripting interface is very important. Similar to GDB, LLDB also has a Python scripting interface. Instead of <strong>.gdbinit</strong>, LLDB loads commands from <strong>.lldbinit</strong> during startup. There is a great <strong>lldbinit</strong> project that contains many custom commands which makes LLDB so much nicer to use, and I have a <a href=https://github.com/daniellimws/lldbinit>fork of it</a>.</p>
<p>(It is such a pain to even set breakpoints, vanilla LLDB is just not usable imo.)</p>
<h2 id=lldb-architecture-and-python-bindings>LLDB Architecture and Python Bindings<a hidden class=anchor aria-hidden=true href=#lldb-architecture-and-python-bindings>#</a></h2>
<p>Having the lldbinit extension is good. Being able to add my own custom commands is even better. To do so, I had to understand the architecture of the scripting interface.</p>
<p>The LLDB scripting interface is quite tidy. Everything is grouped into modules. Quoting the docs, here are less than half of the modules:</p>
<ul>
<li><code>SBAddress</code>
<ul>
<li>A section + offset based address class.</li>
</ul>
</li>
<li><code>SBBreakpoint</code>
<ul>
<li>Represents a logical breakpoint and its associated settings.</li>
</ul>
</li>
<li><code>SBBreakpointList</code>
<ul>
<li>Proxy of C++ <code>lldb::SBBreakpointList</code> class</li>
</ul>
</li>
<li><code>SBBreakpointLocation</code>
<ul>
<li>Represents one unique instance (by address) of a logical breakpoint.</li>
</ul>
</li>
<li><code>SBCommandInterpreter</code>
<ul>
<li><code>SBCommandInterpreter</code> handles/interprets commands for lldb.</li>
</ul>
</li>
<li><code>SBCommandReturnObject</code>
<ul>
<li>Represents a container which holds the result from command execution.</li>
</ul>
</li>
</ul>
<p>Feels like writing C++ but in Python. And the basic architecture is as follows:</p>
<pre tabindex=0><code>LLDB design:
------------|
lldb -&gt; debugger -&gt; target -&gt; process -&gt; thread -&gt; frame(s)
                                      -&gt; thread -&gt; frame(s)
</code></pre><ul>
<li><code>LLDB</code> talks to the <code>debugger</code> object</li>
<li><code>debugger</code> holds a <code>target</code></li>
<li><code>target</code> holds a <code>process</code></li>
<li><code>process</code> holds multiple <code>threads</code></li>
<li>and lastly, each <code>thread</code> has one or more <code>frame</code>s</li>
</ul>
<p>With more details (quoting the docs):</p>
<ul>
<li><code>SBTarget</code>: Represents the <strong>target program</strong> running under the debugger.
<ul>
<li>Gives information about the <strong>executable</strong>, <strong>process</strong>, <strong>modules</strong>, <strong>memory</strong>, <strong>breakpoints</strong>, etc</li>
<li>There&rsquo;s a lot, check the <a href=https://lldb.llvm.org/python_reference/lldb.SBTarget-class.html>docs</a></li>
</ul>
</li>
<li><code>SBProcess</code>: Represents the <strong>process</strong> associated with the target program.
<ul>
<li>Gives information about the <strong>process</strong>, <strong>memory</strong></li>
<li>Some overlap with the above, but this one doesn&rsquo;t have <strong>modules</strong> nor <strong>breakpoints</strong></li>
<li>Check the <a href=https://lldb.llvm.org/python_reference/lldb.SBProcess-class.html>docs</a></li>
</ul>
</li>
<li><code>SBThread</code>: Represents a <strong>thread</strong> of execution.
<ul>
<li>Gives information about a <strong>thread</strong>, e.g. thread ID</li>
<li>Exposes functions for <strong>stepping</strong> (step in, step over, etc) and <strong>suspending/resuming</strong></li>
<li>Contains stack frame(s) (according to docs, it is possible to have more than 1, but I always see just 1)</li>
<li>Check out the <a href=https://lldb.llvm.org/python_reference/lldb.SBThread-class.html>docs</a></li>
</ul>
</li>
<li><code>SBFrame</code>: Represents one of the <strong>stack frames</strong> associated with a thread.
<ul>
<li>Gives information about a <strong>stack frame</strong>, e.g. <strong>registers</strong>, <strong>functions</strong>, <strong>symbols</strong>, <strong>disassembly</strong>, etc</li>
<li>This is a really useful module because of the information it gives.</li>
<li>Check out the <a href=https://lldb.llvm.org/python_reference/lldb.SBFrame-class.html>docs</a></li>
</ul>
</li>
</ul>
<p>Now, some useful functions to access the objects mentioned above (defined by <strong>lldbinit</strong>):</p>
<ul>
<li><code>SBTarget</code> - <code>get_target()</code></li>
<li><code>SBProcess</code> - <code>get_process()</code></li>
<li><code>SBThread</code> - <code>get_thread()</code></li>
<li><code>SBFrame</code> - <code>get_frame()</code></li>
</ul>
<p>Yea, quite easy.</p>
<h2 id=create-custom-commands>Create Custom Commands<a hidden class=anchor aria-hidden=true href=#create-custom-commands>#</a></h2>
<p>To define a new command, it is as simple as creating a function in <strong>lldbinit.py</strong>. For example, to create a command called <code>newcmd</code>:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cmd_newcmd</span>(debugger, command, result, _dict):
    args <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; &#39;</span>)
    <span style=color:#66d9ef>if</span> len(args) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>:
        print(<span style=color:#e6db74>&#39;newcmd &lt;expression&gt;&#39;</span>)
        <span style=color:#66d9ef>return</span>

    <span style=color:#f92672>...</span>
</code></pre></div><p>Then, the function must be registered as a command in the <code>__lldb_init_module</code> method:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>__lldb_init_module</span>(debugger, internal_dict):
    <span style=color:#f92672>...</span>
    ci<span style=color:#f92672>.</span>HandleCommand(<span style=color:#e6db74>&#34;command script add -f lldbinit.cmd_newcmd newcmd&#34;</span>, res)
    <span style=color:#f92672>...</span>
</code></pre></div><p>The function name can be anything, but by convention all command functions in lldbinit go by <code>cmd_&lt;command name></code>.</p>
<p>The function arguments <code>result</code> and <code>_dict</code> might be useful but I don&rsquo;t use them. <code>debugger</code> is the LLDB debugger object mentioned earlier, and <code>command</code> is the exact command string entered by the user.</p>
<p>We can use the API listed above to obtain information about the <strong>target/process/thread/frame</strong>, or perform actions such as <strong>setting breakpoints</strong>, <strong>stepping through instructions</strong>, etc.</p>
<h3 id=example-1-reading-memory>Example 1: Reading Memory<a hidden class=anchor aria-hidden=true href=#example-1-reading-memory>#</a></h3>
<p>Here&rsquo;s a simple command I wrote to print unicode strings from memory (similar to <code>x/s</code> but printing unicode strings).</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cmd_xu</span>(debugger, command, result, _dict):
    args <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; &#39;</span>)
    <span style=color:#66d9ef>if</span> len(args) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>:
        print(<span style=color:#e6db74>&#39;xu &lt;expression&gt;&#39;</span>)
        <span style=color:#66d9ef>return</span>

    addr <span style=color:#f92672>=</span> int(get_frame()<span style=color:#f92672>.</span>EvaluateExpression(args[<span style=color:#ae81ff>0</span>])<span style=color:#f92672>.</span>GetValue(), <span style=color:#ae81ff>10</span>)
    error <span style=color:#f92672>=</span> lldb<span style=color:#f92672>.</span>SBError()

    ended <span style=color:#f92672>=</span> <span style=color:#66d9ef>False</span>
    s <span style=color:#f92672>=</span> <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;&#39;</span>
    offset <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>

    <span style=color:#66d9ef>while</span> <span style=color:#f92672>not</span> ended:
        mem <span style=color:#f92672>=</span> get_target()<span style=color:#f92672>.</span>GetProcess()<span style=color:#f92672>.</span>ReadMemory(addr <span style=color:#f92672>+</span> offset, <span style=color:#ae81ff>100</span>, error)
        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>100</span>, <span style=color:#ae81ff>2</span>):
            wc <span style=color:#f92672>=</span> mem[i<span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#f92672>&lt;&lt;</span> <span style=color:#ae81ff>8</span> <span style=color:#f92672>|</span> mem[i]
            s <span style=color:#f92672>+=</span> chr(wc)
            <span style=color:#66d9ef>if</span> wc <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>:
                ended <span style=color:#f92672>=</span> <span style=color:#66d9ef>True</span>
                <span style=color:#66d9ef>break</span>

        offset <span style=color:#f92672>+=</span> <span style=color:#ae81ff>100</span>

    print(s)
</code></pre></div><h3 id=example-2-alias>Example 2: Alias<a hidden class=anchor aria-hidden=true href=#example-2-alias>#</a></h3>
<p>It is also possible to make aliases for long commands. For example, an alias for disabling breakpoints, through the <code>SBCommandInterpreter</code> object obtained via the <code>debugger.GetCommandInterpreter()</code> method.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#75715e># disable breakpoint number</span>
<span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cmd_bpd</span>(debugger, command, result, dict):
    res <span style=color:#f92672>=</span> lldb<span style=color:#f92672>.</span>SBCommandReturnObject()
    debugger<span style=color:#f92672>.</span>GetCommandInterpreter()<span style=color:#f92672>.</span>HandleCommand(<span style=color:#e6db74>&#34;breakpoint disable &#34;</span> <span style=color:#f92672>+</span> command, res)
    print(res<span style=color:#f92672>.</span>GetOutput())
</code></pre></div><h3 id=example-3-function-tracing>Example 3: Function Tracing<a hidden class=anchor aria-hidden=true href=#example-3-function-tracing>#</a></h3>
<p>Lastly, here is an example of a more complicated command I wrote to get the list of functions called by the target. This is useful when I am attaching LLDB to Safari, and want to know the functions in a library that were called by Safari when loading a webpage.</p>
<p>For example, to see the functions in <code>CoreGraphics</code> called when browsing Wikipedia:</p>
<pre tabindex=0><code>(lldbinit) cz CoreGraphics
[+] Creating breakpoints for all symbols in CoreGraphics
[+] Done creating breakpoints for all symbols in CoreGraphics
0x7fff2505d324:
| CoreGraphics CGColorSpaceUsesExtendedRange
|__ WebKit WebKit::ShareableBitmap::calculateBytesPerRow(WebCore::IntSize, WebKit::ShareableBitmap::Configuration const&amp;)
0x7fff2504a997:
| CoreGraphics CGColorSpaceGetNumberOfComponents
|__ QuartzCore CABackingStorePrepareUpdates_(CABackingStore*, unsigned long, unsigned long, unsigned int, unsigned int, unsigned int, unsigned long long, CA::GenericContext*, UpdateState*)
0x7fff250496fc:
| CoreGraphics CGColorSpaceRetain
|__ QuartzCore CA::CG::IOSurfaceDrawable::IOSurfaceDrawable(__IOSurface*, unsigned int, unsigned int, CGColorSpace*, int, int, unsigned int, unsigned int)
0x7fff2549cd24:
| CoreGraphics CFRetain
|__ CoreGraphics CGColorSpaceRetain
0x7fff2504971c:
| CoreGraphics cs_retain_count
|__ CoreFoundation _CFRetain
0x7fff2504e3d8:
| CoreGraphics CGColorSpaceRelease
|__ QuartzCore CABackingStorePrepareUpdates_(CABackingStore*, unsigned long, unsigned long, unsigned int, unsigned int, unsigned int, unsigned long long, CA::GenericContext*, UpdateState*)
0x7fff2505fdd1:
| CoreGraphics CGSNewEmptyRegion
|__ QuartzCore CABackingStorePrepareUpdates_(CABackingStore*, unsigned long, unsigned long, unsigned int, unsigned int, unsigned int, unsigned long long, CA::GenericContext*, UpdateState*)
...
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>cmd_cz</span>(debugger, command, result, _dict):
    args <span style=color:#f92672>=</span> command<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39; &#39;</span>)
    <span style=color:#66d9ef>if</span> len(args) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>:
        print(<span style=color:#e6db74>&#39;cov &lt;module name&gt;&#39;</span>)
        <span style=color:#66d9ef>return</span>

    module_name <span style=color:#f92672>=</span> args[<span style=color:#ae81ff>0</span>]
    target <span style=color:#f92672>=</span> debugger<span style=color:#f92672>.</span>GetSelectedTarget()
    module <span style=color:#f92672>=</span> find_module_by_name(get_target(), module_name)

    <span style=color:#75715e># to keep track of the breakpoints set</span>
    bpmap <span style=color:#f92672>=</span> {}
    print(<span style=color:#e6db74>&#34;[+] Creating breakpoints for all symbols in&#34;</span>, module_name)
    <span style=color:#66d9ef>for</span> symbol <span style=color:#f92672>in</span> module:
        sym_name <span style=color:#f92672>=</span> symbol<span style=color:#f92672>.</span>GetName()
        <span style=color:#66d9ef>if</span> sym_name<span style=color:#f92672>.</span>startswith(<span style=color:#e6db74>&#34;os&#34;</span>) <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;pthread&#34;</span> <span style=color:#f92672>in</span> sym_name <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;lock&#34;</span> <span style=color:#f92672>in</span> sym_name <span style=color:#f92672>or</span> <span style=color:#e6db74>&#34;operator&#34;</span> <span style=color:#f92672>in</span> sym_name:
            <span style=color:#66d9ef>continue</span>
        address <span style=color:#f92672>=</span> symbol<span style=color:#f92672>.</span>GetStartAddress()<span style=color:#f92672>.</span>GetLoadAddress(target)
        bp <span style=color:#f92672>=</span> target<span style=color:#f92672>.</span>BreakpointCreateByAddress(address)
        bpmap[address] <span style=color:#f92672>=</span> bp
    print(<span style=color:#e6db74>&#34;[+] Done creating breakpoints for all symbols in&#34;</span>, module_name)

    visited <span style=color:#f92672>=</span> []
    <span style=color:#66d9ef>while</span> <span style=color:#66d9ef>True</span>:
        get_process()<span style=color:#f92672>.</span>Continue()

        thread <span style=color:#f92672>=</span> get_thread()
        rip <span style=color:#f92672>=</span> int(str(get_frame()<span style=color:#f92672>.</span>reg[<span style=color:#e6db74>&#34;rip&#34;</span>]<span style=color:#f92672>.</span>value), <span style=color:#ae81ff>16</span>)

        <span style=color:#66d9ef>if</span> rip <span style=color:#f92672>in</span> visited:
            <span style=color:#66d9ef>continue</span>

        <span style=color:#66d9ef>if</span> rip <span style=color:#f92672>not</span> <span style=color:#f92672>in</span> bpmap<span style=color:#f92672>.</span>keys():
            print(<span style=color:#e6db74>&#34;[+] Dead&#34;</span>)   <span style=color:#75715e># crashed or something</span>
            <span style=color:#66d9ef>break</span>
        <span style=color:#75715e># disable breakpoint after reaching it one time</span>
        bpmap[rip]<span style=color:#f92672>.</span>SetEnabled(<span style=color:#66d9ef>False</span>)

        print(hex(rip) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;:&#34;</span>)
        <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(<span style=color:#ae81ff>2</span>):
            frame <span style=color:#f92672>=</span> thread<span style=color:#f92672>.</span>GetFrameAtIndex(i)
            symbol <span style=color:#f92672>=</span> frame<span style=color:#f92672>.</span>GetSymbol()
            module <span style=color:#f92672>=</span> frame<span style=color:#f92672>.</span>GetModule()<span style=color:#f92672>.</span>GetFileSpec()<span style=color:#f92672>.</span>GetFilename()

            print(<span style=color:#e6db74>&#34;|&#34;</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;__&#34;</span> <span style=color:#f92672>*</span> i, module, symbol<span style=color:#f92672>.</span>GetName())
</code></pre></div><p>In this example, I created a breakpoint using <code>target.BreakpointCreateByAddress(address)</code>, by using the <code>SBSymbol</code> methods to get a function&rsquo;s address in the process. I also used the lldbinit helper function <code>find_module_by_name</code> to get a <code>SBModule</code> object given a module name.</p>
<p>There were more unmentioned API calls used by this command, read the code to learn more if you are interested.</p>
<p>That&rsquo;s all. Hope you find this useful :D</p>
<p><strong>References:</strong></p>
<ul>
<li><a href=https://lldb.llvm.org/python_reference/lldb-module.html>LLDB docs</a></li>
<li><a href=https://github.com/daniellimws/lldbinit>lldbinit</a>
<ul>
<li>fork of <a href=https://github.com/peternguyen93/lldbinit>peter&rsquo;s</a>
<ul>
<li>fork of <a href=https://github.com/gdbinit/lldbinit>gdbinit&rsquo;s</a>
<ul>
<li>fork of <a href=https://github.com/deroko/lldbinit>deroko&rsquo;s</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://nusgreyhats.org/tags/writeups/>writeups</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://nusgreyhats.org/posts/secweds/ay2122s1/sw0311/>
<span class=title>Â« Prev Page</span>
<br>
<span>SecWed #031121</span>
</a>
<a class=next href=https://nusgreyhats.org/posts/secweds/ay2122s1/sw2710/>
<span class=title>Next Page Â»</span>
<br>
<span>SecWed #271021</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Basic LLDB Scripting on twitter" href="https://twitter.com/intent/tweet/?text=Basic%20LLDB%20Scripting&url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f&hashtags=writeups"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Basic LLDB Scripting on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f&title=Basic%20LLDB%20Scripting&summary=Basic%20LLDB%20Scripting&source=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Basic LLDB Scripting on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f&title=Basic%20LLDB%20Scripting"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Basic LLDB Scripting on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Basic LLDB Scripting on whatsapp" href="https://api.whatsapp.com/send?text=Basic%20LLDB%20Scripting%20-%20https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Basic LLDB Scripting on telegram" href="https://telegram.me/share/url?text=Basic%20LLDB%20Scripting&url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fbasic-lldb-scripting%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://nusgreyhats.org/>NUS Greyhats</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light'),document.getElementById("logo").src="/greyhats.png"):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'),document.getElementById("logo").src="/greyhats-dark.png")})</script>
</body>
</html>