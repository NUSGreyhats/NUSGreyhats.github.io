<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>A (not so deep) Dive into Grafana CVE-2021-43798 | NUS Greyhats</title><meta name=keywords content="writeups"><meta name=description content="Tired of log4shell? take some rest then"><meta name=author content="5p4d37"><link rel=canonical href=https://nusgreyhats.org/posts/writeups/a-not-so-deep-dive-in-to-grafana-cve-2021-43798/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel=stylesheet><link crossorigin=anonymous href=/assets/css/stylesheet.min.b268fb3bd1950526ba32df2898e8dfc3171f0fecdf09cd6945557b277f0eecf8.css integrity="sha256-smj7O9GVBSa6Mt8omOjfwxcfD+zfCc1pRVV7J38O7Pg=" rel="preload stylesheet" as=style><link rel=preload href=/greyhats-dark.png as=image><script defer crossorigin=anonymous src=/assets/js/highlight.min.4dcb3c4f38462f66c6b6137227726f5543cb934cca9788f041c087e374491df2.js integrity="sha256-Tcs8TzhGL2bGthNyJ3JvVUPLk0zKl4jwQcCH43RJHfI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://nusgreyhats.org/greyhats.png><link rel=icon type=image/png sizes=16x16 href=https://nusgreyhats.org/greyhats.png><link rel=icon type=image/png sizes=32x32 href=https://nusgreyhats.org/greyhats.png><link rel=apple-touch-icon href=https://nusgreyhats.org/greyhats.png><link rel=mask-icon href=https://nusgreyhats.org/greyhats.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.96.0"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="A (not so deep) Dive into Grafana CVE-2021-43798"><meta property="og:description" content="Tired of log4shell? take some rest then"><meta property="og:type" content="article"><meta property="og:url" content="https://nusgreyhats.org/posts/writeups/a-not-so-deep-dive-in-to-grafana-cve-2021-43798/"><meta property="og:image" content="https://nusgreyhats.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-12-17T00:00:00+00:00"><meta property="article:modified_time" content="2021-12-17T00:00:00+00:00"><meta property="og:site_name" content="NUS Greyhats"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://nusgreyhats.org/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="A (not so deep) Dive into Grafana CVE-2021-43798"><meta name=twitter:description content="Tired of log4shell? take some rest then"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://nusgreyhats.org/posts/"},{"@type":"ListItem","position":2,"name":"A (not so deep) Dive into Grafana CVE-2021-43798","item":"https://nusgreyhats.org/posts/writeups/a-not-so-deep-dive-in-to-grafana-cve-2021-43798/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"A (not so deep) Dive into Grafana CVE-2021-43798","name":"A (not so deep) Dive into Grafana CVE-2021-43798","description":"Tired of log4shell? take some rest then","keywords":["writeups"],"articleBody":"Overview This post will cover some details behind the recent Grafana vulnerability (CVE-2021-43798), which is a directory traversal bug allowing unauthenticated attackers to read files on the target server filesystem. This post will also discuss some real world scenario and attack surface of the Grafana.\nBrief Analysis on the Root Cause The detailed analysis can be found at the author’s blog here, I will only briefly cover it.\nAll API routes were defined in pkg/api/api.go , some require authentication like below:\n\tr.Get(\"/plugins\", reqSignedIn, hs.Index) \tr.Get(\"/plugins/:id/\", reqSignedIn, hs.Index) \tr.Get(\"/plugins/:id/edit\", reqSignedIn, hs.Index) // deprecated \tr.Get(\"/plugins/:id/page/:page\", reqSignedIn, hs.Index) While some does not require signed in, like below:\n\t// expose plugin file system assets \tr.Get(\"/public/plugins/:pluginId/*\", hs.getPluginAssets) For the route at /public/plugins/:pluginId/*, it is handled by hs.getPluginAssets, which is defined in pkg/api/plugins.go:\n// getPluginAssets returns public plugin assets (images, JS, etc.) // // /public/plugins/:pluginId/* func (hs *HTTPServer) getPluginAssets(c *models.ReqContext) { \tpluginID := web.Params(c.Req)[\":pluginId\"] \tplugin, exists := hs.pluginStore.Plugin(c.Req.Context(), pluginID) \tif !exists { \tc.JsonApiErr(404, \"Plugin not found\", nil) \treturn \t}  \trequestedFile := filepath.Clean(web.Params(c.Req)[\"*\"]) \tpluginFilePath := filepath.Join(plugin.PluginDir, requestedFile)  \tif !plugin.IncludedInSignature(requestedFile) { \ths.log.Warn(\"Access to requested plugin file will be forbidden in upcoming Grafana versions as the file \"+ \t\"is not included in the plugin signature\", \"file\", requestedFile) \t}  \t// It's safe to ignore gosec warning G304 since we already clean the requested file path and subsequently \t// use this with a prefix of the plugin's directory, which is set during plugin loading \t// nolint:gosec \tf, err := os.Open(pluginFilePath)   the rest are Omitted Line 5 is retrieving /public/plugins/(.*) as the pluginId, then pass to line 12 filepath.Clean to do sanitization, and concatenate in line 13, finally passed to os.Open in line 23 to read the contents.\nThe most interesting part is the comment at line 20:\n // It’s safe to ignore gosec warning G304 since we already clean the requested file path and subsequently\n If we check the document on the usage of filepath.Clean:\n  Point 4 is worthy to take note.\n replace “/..” by “/” at the beginning of a path\n What if the path does not start with /..? we can try it out:\n  It seems that filepath.Clean is not working as what the developers expect it to do, which leads to directory traversal and subsequently arbitrary file read.\nIt can be replicated in the docker environment as shown below (take note that the plugin should exist, otherwise you will get Plugin not found error. Luckily, Grafana has come with some default plugins. In the screenshot below, I am using Grafana’s welcome plugin):\n  Nginx Reverse Proxy Bypass On the day this vulnerability is getting hot amongst the security researchers (around 7th Dec, 2021), the vulnerability author posted a tweet as below:\n  But one day later, he retweeted:\n  So does Nginx help? we can set up the environment and try:\n  We are getting a 400 bad request.\nThe reason is simple: Nginx will do path normalization before it forwards the request to the backend. If the normalized URI is requesting beyond the web root directory, it will simply returns 400 bad request.\nIn the request above, /public/plugins/welcome/../../../../../../../../../../etc/passwd will be normalized into /../../../../../../../etc/passwd, hence, a 400 bad request is returned.\nBut does that mean Nginx will protect Grafana against this kind of path traversal attack? May not be. It depends on how you configure the proxy_pass entry. Before I cover that, here is an example:\n  We can see that our path traversal still succeed and read the content of the sdk.ts, which is located two directories above the welcome plugin directory.\nSo here is first point, which is covered in the Nginx document\n If proxy_pass is specified without a URI, the request URI is passed to the server in the same form as sent by a client when the original request is processed\n Scroll back and examine my Nginx configuration, noticed that my proxy_pass entry is defined as http://localhost:3000, without a URI, hence, the original request will be forwarded to the Grafana backend. And in the first place, since my original URI is /public/plugins/welcome/../../sdk.ts, even after normalization by Nginx, it is /public/sdk.ts, which is a valid URI, hence, Nginx will not complain about it either.\nThis allows us to read arbitrary files up to three directory above the plugin directories. But the default plugin directories is deep at /usr/share/grafana/public/app/plugins/{plugin_id}, even being able to traverse up by 3 directories, there aren’t many files to read.\nSo here is the second point, which is covered in this post\n URL consists of scheme:[//authority]path[?query][#fragment], and browsers don’t send #fragment. But how must a reverse proxy handle #fragment?\nNginx throws fragment off\n So what would happen if my URI is /public/plugins/welcome/#/../../../../../../../../../etc/passwd?\nNginx will process until /public/plugins/welcome/, and forward the entire URI to the Grafana backend, and leads to path traversal all the way up to the root directory:\n  Attack Surface under Grafana In this section, we try to examine the possible attack surface under Grafana when we are able to read files on the file system.\nGrafana Database We can try to read the database file, which is located at /var/lib/grafana/grafana.db by default, which is a sqlite database:\n  So, what is inside the Grafana database?\nuser table:   The password is hard to decrypt, using a slow hash algorithm with salt as defined in pkg/util/encoding.go:\n// EncodePassword encodes a password using PBKDF2. func EncodePassword(password string, salt string) (string, error) { \tnewPasswd := pbkdf2.Key([]byte(password), []byte(salt), 10000, 50, sha256.New) \treturn hex.EncodeToString(newPasswd), nil } user_auth_token: It seems that user_auth_token is also stored as one-way hash, as defined in /pkg/services/auth/auth_token.go:\nfunc hashToken(token string) string { \thashBytes := sha256.Sum256([]byte(token + setting.SecretKey)) \treturn hex.EncodeToString(hashBytes[:]) } I can’t think of a way to exploit this, if possible, please tell me =)\ndata_source:   The data_source tells Grafana where to pull the data from.\nFinally there is something that we can exploit. In /pkg/cmd/grafana-cli/commands/datamigrations/encrypt_datasource_passwords_test.go:\nfunc DecryptSecureJsonData(ds *models.DataSource) (map[string]string, error) { \tdecrypted := make(map[string]string) \tfor key, data := range ds.SecureJsonData { \tdecryptedData, err := util.Decrypt(data, setting.SecretKey) \tif err != nil { \treturn nil, err \t}  \tdecrypted[key] = string(decryptedData) \t} \treturn decrypted, nil } util.Decrypt is defined in /pkg/util/encryption.go, you can re-use it to decrypt the encrypted password in the data source, or you can use the script here:\n  The secretkey is defined in the Grafana’s configuration file, which is located at /etc/grafana/grafana.ini, and it might contains other sensitive information as well. We will cover those next\nGrafana Configuration File Located at /etc/grafana/grafana.ini by default, which might contain several sensitive information. You can take a look at the default configuration file here and see what can be stored inside. I won’t go through them one by one.\ngrafana-image-renderer Apart from the various credentials that could be leaked from the Grafana’s configuration file, another worth-mentioning entry is the grafana-image-renderer\n[rendering] # Options to configure a remote HTTP image rendering service, e.g. using https://github.com/grafana/grafana-image-renderer. # URL to a remote HTTP image renderer service, e.g. http://localhost:8081/render, will enable Grafana to render panels and dashboards to PNG-images using HTTP requests to an external service. server_url = # If the remote HTTP image renderer service runs on a different server than the Grafana server you may have to configure this to a URL where Grafana is reachable, e.g. http://grafana.domain/. callback_url = # Concurrent render request limit affects when the /render HTTP endpoint is used. Rendering many images at the same time can overload the server, # which this setting can help protect against by only allowing a certain amount of concurrent requests. concurrent_render_request_limit = 30 grafana-image-renderer is a remote HTTP image rendering service, which you can ask the renderer to visit the Grafana panel, render into image and send to us.\nThe official guideline is to set up the grafana-image-renderer service inside a separate docker, and link it to the Grafana docker using Docker Compose like below:\nversion: '2' services: grafana: image: grafana/grafana:latest ports: - '3000:3000' environment: GF_RENDERING_SERVER_URL: http://renderer:8081/render GF_RENDERING_CALLBACK_URL: http://grafana:3000/ GF_LOG_FILTERS: rendering:debug renderer: image: grafana/grafana-image-renderer:latest ports: - 8081 Under this configuration, the renderer service is inaccessible from the Internet.\nHowever, there is another option to run it as a standalone Node.js application.\n  It seems that the service is also listening on the localhost, but actually it is accessible via public network interface:\n  Exposing a renderer that attackers can specify any host for it to visit is not that dangerous unless you are running an outdated renderer:\n  And without sandbox:\n  So RCE is achievable:\n  Reference https://grafana.com/blog/2021/12/08/an-update-on-0day-cve-2021-43798-grafana-directory-traversal/\nhttps://j0vsec.com/post/cve-2021-43798/\nhttps://mp.weixin.qq.com/s/dqJ3F_fStlj78S0qhQ3Ggw\nhttps://pkg.go.dev/path/filepath\nhttps://www.acunetix.com/blog/articles/a-fresh-look-on-reverse-proxy-related-attacks/\nhttps://articles.zsxq.com/id_jb6bwow4zf5p.html\nhttps://articles.zsxq.com/id_baeb9hmiroq5.html\nhttps://github.com/jas502n/Grafana-CVE-2021-43798\nhttps://securitylab.github.com/research/in_the_wild_chrome_cve_2021_30632/\n","wordCount":"1391","inLanguage":"en","datePublished":"2021-12-17T00:00:00Z","dateModified":"2021-12-17T00:00:00Z","author":{"@type":"Person","name":"5p4d37"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://nusgreyhats.org/posts/writeups/a-not-so-deep-dive-in-to-grafana-cve-2021-43798/"},"publisher":{"@type":"Organization","name":"NUS Greyhats","logo":{"@type":"ImageObject","url":"https://nusgreyhats.org/greyhats.png"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://nusgreyhats.org/ accesskey=h title="NUS Greyhats (Alt + H)"><img src=/greyhats-dark.png alt=logo aria-label=logo id=logo height=35>
<script>localStorage.getItem("pref-theme")==="light"?document.getElementById("logo").src="/greyhats.png":document.getElementById("logo").src="/greyhats-dark.png"</script>NUS Greyhats</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://nusgreyhats.org/team title="the team"><span>the team</span></a></li><li><a href=https://nusgreyhats.org/secweds title=secweds><span>secweds</span></a></li><li><a href=https://nusgreyhats.org/resources/ title=resources><span>resources</span></a></li><li><a href=https://nusgreyhats.org/tags/ title=tags><span>tags</span></a></li><li><a href=https://nusgreyhats.org/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>A (not so deep) Dive into Grafana CVE-2021-43798</h1><div class=post-description>Tired of log4shell? take some rest then</div><div class=post-meta>December 17, 2021&nbsp;·&nbsp;7 min&nbsp;·&nbsp;5p4d37&nbsp;|&nbsp;<a href=https://github.com/NUSGreyhats/NUSGreyhats.github.io/tree/master/content/posts/writeups/A%20%28not%20so%20deep%29%20Dive%20in%20to%20Grafana%20CVE-2021-43798.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><h1 id=overview>Overview<a hidden class=anchor aria-hidden=true href=#overview>#</a></h1><p>This post will cover some details behind the recent Grafana vulnerability (CVE-2021-43798), which is a directory traversal bug allowing unauthenticated attackers to read files on the target server filesystem. This post will also discuss some real world scenario and attack surface of the Grafana.</p><h1 id=brief-analysis-on-the-root-cause>Brief Analysis on the Root Cause<a hidden class=anchor aria-hidden=true href=#brief-analysis-on-the-root-cause>#</a></h1><p>The detailed analysis can be found at the author&rsquo;s blog <a href=https://j0vsec.com/post/cve-2021-43798/>here</a>, I will only briefly cover it.</p><p>All API routes were defined in <a href=https://github.com/grafana/grafana/blob/v8.3.0/pkg/api/api.go#L140-L141>pkg/api/api.go</a> , some require authentication like below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;/plugins&#34;</span>, <span style=color:#a6e22e>reqSignedIn</span>, <span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>Index</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;/plugins/:id/&#34;</span>, <span style=color:#a6e22e>reqSignedIn</span>, <span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>Index</span>)
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;/plugins/:id/edit&#34;</span>, <span style=color:#a6e22e>reqSignedIn</span>, <span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>Index</span>) <span style=color:#75715e>// deprecated
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;/plugins/:id/page/:page&#34;</span>, <span style=color:#a6e22e>reqSignedIn</span>, <span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>Index</span>)
</span></span></code></pre></div><p>While some does not require signed in, like below:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span>	<span style=color:#75715e>// expose plugin file system assets
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>r</span>.<span style=color:#a6e22e>Get</span>(<span style=color:#e6db74>&#34;/public/plugins/:pluginId/*&#34;</span>, <span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>getPluginAssets</span>)
</span></span></code></pre></div><p>For the route at <code>/public/plugins/:pluginId/*</code>, it is handled by <code>hs.getPluginAssets</code>, which is defined in <a href=https://github.com/grafana/grafana/blob/v8.3.0/pkg/api/plugins.go#L273-L323>pkg/api/plugins.go</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// getPluginAssets returns public plugin assets (images, JS, etc.)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//
</span></span></span><span style=display:flex><span><span style=color:#75715e>// /public/plugins/:pluginId/*
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>hs</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>HTTPServer</span>) <span style=color:#a6e22e>getPluginAssets</span>(<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>ReqContext</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pluginID</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>web</span>.<span style=color:#a6e22e>Params</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Req</span>)[<span style=color:#e6db74>&#34;:pluginId&#34;</span>]
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>plugin</span>, <span style=color:#a6e22e>exists</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>pluginStore</span>.<span style=color:#a6e22e>Plugin</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Req</span>.<span style=color:#a6e22e>Context</span>(), <span style=color:#a6e22e>pluginID</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>exists</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>JsonApiErr</span>(<span style=color:#ae81ff>404</span>, <span style=color:#e6db74>&#34;Plugin not found&#34;</span>, <span style=color:#66d9ef>nil</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>requestedFile</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Clean</span>(<span style=color:#a6e22e>web</span>.<span style=color:#a6e22e>Params</span>(<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>Req</span>)[<span style=color:#e6db74>&#34;*&#34;</span>])
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>pluginFilePath</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filepath</span>.<span style=color:#a6e22e>Join</span>(<span style=color:#a6e22e>plugin</span>.<span style=color:#a6e22e>PluginDir</span>, <span style=color:#a6e22e>requestedFile</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>plugin</span>.<span style=color:#a6e22e>IncludedInSignature</span>(<span style=color:#a6e22e>requestedFile</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>hs</span>.<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Warn</span>(<span style=color:#e6db74>&#34;Access to requested plugin file will be forbidden in upcoming Grafana versions as the file &#34;</span><span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>			<span style=color:#e6db74>&#34;is not included in the plugin signature&#34;</span>, <span style=color:#e6db74>&#34;file&#34;</span>, <span style=color:#a6e22e>requestedFile</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// It&#39;s safe to ignore gosec warning G304 since we already clean the requested file path and subsequently
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// use this with a prefix of the plugin&#39;s directory, which is set during plugin loading
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// nolint:gosec
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#a6e22e>pluginFilePath</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>the</span> <span style=color:#a6e22e>rest</span> <span style=color:#a6e22e>are</span> <span style=color:#a6e22e>Omitted</span>
</span></span></code></pre></div><p>Line 5 is retrieving <code>/public/plugins/(.*)</code> as the <code>pluginId</code>, then pass to line 12 <code>filepath.Clean</code> to do sanitization, and concatenate in line 13, finally passed to <code>os.Open</code> in line 23 to read the contents.</p><p>The most interesting part is the comment at line 20:</p><blockquote><p>// It&rsquo;s safe to ignore gosec warning G304 since we already clean the requested file path and subsequently</p></blockquote><p>If we check the <a href=https://pkg.go.dev/path/filepath>document</a> on the usage of <code>filepath.Clean</code>:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218092233145.png></figure><p>Point 4 is worthy to take note.</p><blockquote><p>replace &ldquo;/..&rdquo; by &ldquo;/&rdquo; at the beginning of a path</p></blockquote><p>What if the path does not start with <code>/..</code>? we can try it out:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218092157371.png></figure><p>It seems that <code>filepath.Clean</code> is not working as what the developers expect it to do, which leads to directory traversal and subsequently arbitrary file read.</p><p>It can be replicated in the docker environment as shown below (take note that the plugin should exist, otherwise you will get <code>Plugin not found</code> error. Luckily, Grafana has come with some default plugins. In the screenshot below, I am using Grafana&rsquo;s <code>welcome</code> plugin):</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218092120386.png></figure><h1 id=nginx-reverse-proxy-bypass>Nginx Reverse Proxy Bypass<a hidden class=anchor aria-hidden=true href=#nginx-reverse-proxy-bypass>#</a></h1><p>On the day this vulnerability is getting hot amongst the security researchers (around 7th Dec, 2021), the vulnerability author posted a tweet as <a href=https://twitter.com/j0v0x0/status/1468171135800033282>below</a>:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218001042889.png></figure><p>But one day later, he retweeted:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211217234000126.png></figure><p>So does Nginx help? we can set up the environment and try:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218092029240.png></figure><p>We are getting a 400 bad request.</p><p>The reason is simple: Nginx will do <strong>path normalization</strong> before it forwards the request to the backend. If the normalized URI is requesting beyond the web root directory, it will simply returns 400 bad request.</p><p>In the request above, <code>/public/plugins/welcome/../../../../../../../../../../etc/passwd</code> will be normalized into <code>/../../../../../../../etc/passwd</code>, hence, a 400 bad request is returned.</p><p>But does that mean Nginx will protect Grafana against this kind of path traversal attack? May not be. It depends on how you configure the <code>proxy_pass</code> entry. Before I cover that, here is an example:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218091931664.png></figure><p>We can see that our path traversal still succeed and read the content of the <code>sdk.ts</code>, which is located two directories above the welcome plugin directory.</p><p>So here is first point, which is covered in the Nginx <a href=http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass>document</a></p><blockquote><p>If <code>proxy_pass</code> is specified without a URI, the request URI is passed to the server in the same form as sent by a client when the original request is processed</p></blockquote><p>Scroll back and examine my Nginx configuration, noticed that my <code>proxy_pass</code> entry is defined as <code>http://localhost:3000</code>, without a URI, hence, the original request will be forwarded to the Grafana backend. And in the first place, since my original URI is <code>/public/plugins/welcome/../../sdk.ts</code>, even after normalization by Nginx, it is <code>/public/sdk.ts</code>, which is a valid URI, hence, Nginx will not complain about it either.</p><p>This allows us to read arbitrary files <strong>up to three directory above the plugin directories</strong>. But the default plugin directories is deep at <code>/usr/share/grafana/public/app/plugins/{plugin_id}</code>, even being able to traverse up by 3 directories, there aren&rsquo;t many files to read.</p><p>So here is the second point, which is covered in this <a href=https://www.acunetix.com/blog/articles/a-fresh-look-on-reverse-proxy-related-attacks/>post</a></p><blockquote><p>URL consists of <code>scheme:[//authority]path[?query][#fragment]</code>, and browsers don’t send <code>#fragment</code>. But how must a reverse proxy handle <code>#fragment</code>?</p><p>Nginx throws fragment off</p></blockquote><p>So what would happen if my URI is <code>/public/plugins/welcome/#/../../../../../../../../../etc/passwd</code>?</p><p>Nginx will process until <code>/public/plugins/welcome/</code>, and forward the entire URI to the Grafana backend, and leads to path traversal all the way up to the root directory:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218000920958.png></figure><h1 id=attack-surface-under-grafana>Attack Surface under Grafana<a hidden class=anchor aria-hidden=true href=#attack-surface-under-grafana>#</a></h1><p>In this section, we try to examine the possible attack surface under Grafana when we are able to read files on the file system.</p><h3 id=grafana-database>Grafana Database<a hidden class=anchor aria-hidden=true href=#grafana-database>#</a></h3><p>We can try to read the database file, which is located at <code>/var/lib/grafana/grafana.db</code> by default, which is a sqlite database:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218101302363.png></figure><p>So, what is inside the Grafana database?</p><h4 id=user-table>user table:<a hidden class=anchor aria-hidden=true href=#user-table>#</a></h4><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218110015309.png></figure><p>The password is hard to decrypt, using a slow hash algorithm with salt as defined in <a href=https://github.com/grafana/grafana/blob/v8.3.0/pkg/util/encoding.go#L33-L37>pkg/util/encoding.go</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#75715e>// EncodePassword encodes a password using PBKDF2.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>EncodePassword</span>(<span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>, <span style=color:#a6e22e>salt</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>newPasswd</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>pbkdf2</span>.<span style=color:#a6e22e>Key</span>([]byte(<span style=color:#a6e22e>password</span>), []byte(<span style=color:#a6e22e>salt</span>), <span style=color:#ae81ff>10000</span>, <span style=color:#ae81ff>50</span>, <span style=color:#a6e22e>sha256</span>.<span style=color:#a6e22e>New</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>hex</span>.<span style=color:#a6e22e>EncodeToString</span>(<span style=color:#a6e22e>newPasswd</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=user_auth_token>user_auth_token:<a hidden class=anchor aria-hidden=true href=#user_auth_token>#</a></h4><p>It seems that user_auth_token is also stored as one-way hash, as defined in <a href=https://github.com/grafana/grafana/blob/v8.3.0/pkg/services/auth/auth_token.go#L451-L454>/pkg/services/auth/auth_token.go</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>hashToken</span>(<span style=color:#a6e22e>token</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>string</span> {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>hashBytes</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>sha256</span>.<span style=color:#a6e22e>Sum256</span>([]byte(<span style=color:#a6e22e>token</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>setting</span>.<span style=color:#a6e22e>SecretKey</span>))
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>hex</span>.<span style=color:#a6e22e>EncodeToString</span>(<span style=color:#a6e22e>hashBytes</span>[:])
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>I can&rsquo;t think of a way to exploit this, if possible, please tell me =)</p><h4 id=data_source>data_source:<a hidden class=anchor aria-hidden=true href=#data_source>#</a></h4><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218112800825.png></figure><p>The data_source tells Grafana where to pull the data from.</p><p>Finally there is something that we can exploit. In <a href=https://github.com/grafana/grafana/blob/v8.3.0/pkg/cmd/grafana-cli/commands/datamigrations/encrypt_datasource_passwords_test.go#L98-L109>/pkg/cmd/grafana-cli/commands/datamigrations/encrypt_datasource_passwords_test.go</a>:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>DecryptSecureJsonData</span>(<span style=color:#a6e22e>ds</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>models</span>.<span style=color:#a6e22e>DataSource</span>) (<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>) {
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>decrypted</span> <span style=color:#f92672>:=</span> make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#66d9ef>string</span>)
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>data</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>ds</span>.<span style=color:#a6e22e>SecureJsonData</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>decryptedData</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>util</span>.<span style=color:#a6e22e>Decrypt</span>(<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>setting</span>.<span style=color:#a6e22e>SecretKey</span>)
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>, <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>decrypted</span>[<span style=color:#a6e22e>key</span>] = string(<span style=color:#a6e22e>decryptedData</span>)
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>decrypted</span>, <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>util.Decrypt</code> is defined in <a href=https://github.com/grafana/grafana/blob/v8.3.0/pkg/util/encryption.go>/pkg/util/encryption.go</a>, you can re-use it to decrypt the encrypted password in the data source, or you can use the script <a href=https://github.com/jas502n/Grafana-CVE-2021-43798/blob/main/AESDecrypt.go>here</a>:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218113745095.png></figure><p>The <code>secretkey</code> is defined in the Grafana&rsquo;s configuration file, which is located at <code>/etc/grafana/grafana.ini</code>, and it might contains other sensitive information as well. We will cover those next</p><h3 id=grafana-configuration-file>Grafana Configuration File<a hidden class=anchor aria-hidden=true href=#grafana-configuration-file>#</a></h3><p>Located at <code>/etc/grafana/grafana.ini</code> by default, which might contain several sensitive information. You can take a look at the default configuration file <a href=https://github.com/grafana/grafana/blob/main/conf/defaults.ini>here</a> and see what can be stored inside. I won&rsquo;t go through them one by one.</p><h4 id=grafana-image-renderer>grafana-image-renderer<a hidden class=anchor aria-hidden=true href=#grafana-image-renderer>#</a></h4><p>Apart from the various credentials that could be leaked from the Grafana&rsquo;s configuration file, another worth-mentioning entry is the <a href=https://github.com/grafana/grafana/blob/main/conf/defaults.ini#L964-L972>grafana-image-renderer</a></p><pre tabindex=0><code>[rendering]
# Options to configure a remote HTTP image rendering service, e.g. using https://github.com/grafana/grafana-image-renderer.
# URL to a remote HTTP image renderer service, e.g. http://localhost:8081/render, will enable Grafana to render panels and dashboards to PNG-images using HTTP requests to an external service.
server_url =
# If the remote HTTP image renderer service runs on a different server than the Grafana server you may have to configure this to a URL where Grafana is reachable, e.g. http://grafana.domain/.
callback_url =
# Concurrent render request limit affects when the /render HTTP endpoint is used. Rendering many images at the same time can overload the server,
# which this setting can help protect against by only allowing a certain amount of concurrent requests.
concurrent_render_request_limit = 30
</code></pre><p>grafana-image-renderer is a remote HTTP image rendering service, which you can ask the renderer to visit the Grafana panel, render into image and send to us.</p><p>The official guideline is to set up the grafana-image-renderer service inside a separate docker, and link it to the Grafana docker using Docker Compose like below:</p><pre tabindex=0><code>version: &#39;2&#39;

services:
  grafana:
    image: grafana/grafana:latest
    ports:
      - &#39;3000:3000&#39;
    environment:
      GF_RENDERING_SERVER_URL: http://renderer:8081/render
      GF_RENDERING_CALLBACK_URL: http://grafana:3000/
      GF_LOG_FILTERS: rendering:debug
  renderer:
    image: grafana/grafana-image-renderer:latest
    ports:
      - 8081
</code></pre><p>Under this configuration, the renderer service is inaccessible from the Internet.</p><p>However, there is <a href=https://github.com/grafana/grafana-image-renderer#run-as-standalone-nodejs-application>another option</a> to run it as a standalone Node.js application.</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218115649012.png></figure><p>It seems that the service is also listening on the localhost, but actually it is accessible via public network interface:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218115803383.png></figure><p>Exposing a renderer that attackers can specify any host for it to visit is not that dangerous unless you are running an outdated renderer:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218120020036.png></figure><p>And without sandbox:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218120044608.png></figure><p>So RCE is achievable:</p><figure><img loading=lazy src=/images/CVE-2021-43798/image-20211218121158636.png></figure><h1 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h1><p><a href=https://grafana.com/blog/2021/12/08/an-update-on-0day-cve-2021-43798-grafana-directory-traversal/>https://grafana.com/blog/2021/12/08/an-update-on-0day-cve-2021-43798-grafana-directory-traversal/</a></p><p><a href=https://j0vsec.com/post/cve-2021-43798/>https://j0vsec.com/post/cve-2021-43798/</a></p><p><a href=https://mp.weixin.qq.com/s/dqJ3F_fStlj78S0qhQ3Ggw>https://mp.weixin.qq.com/s/dqJ3F_fStlj78S0qhQ3Ggw</a></p><p><a href=https://pkg.go.dev/path/filepath>https://pkg.go.dev/path/filepath</a></p><p><a href=https://www.acunetix.com/blog/articles/a-fresh-look-on-reverse-proxy-related-attacks/>https://www.acunetix.com/blog/articles/a-fresh-look-on-reverse-proxy-related-attacks/</a></p><p><a href=https://articles.zsxq.com/id_jb6bwow4zf5p.html>https://articles.zsxq.com/id_jb6bwow4zf5p.html</a></p><p><a href=https://articles.zsxq.com/id_baeb9hmiroq5.html>https://articles.zsxq.com/id_baeb9hmiroq5.html</a></p><p><a href=https://github.com/jas502n/Grafana-CVE-2021-43798>https://github.com/jas502n/Grafana-CVE-2021-43798</a></p><p><a href=https://securitylab.github.com/research/in_the_wild_chrome_cve_2021_30632/>https://securitylab.github.com/research/in_the_wild_chrome_cve_2021_30632/</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://nusgreyhats.org/tags/writeups/>writeups</a></li></ul><nav class=paginav><a class=prev href=https://nusgreyhats.org/posts/writeups/htxic-reversing-101/><span class=title>« Prev Page</span><br><span>HTXIC CTF Reversing 101 Writeup</span></a>
<a class=next href=https://nusgreyhats.org/posts/writeups/x-mas-ctf-2021-intensive-training/><span class=title>Next Page »</span><br><span>[X-MAS CTF 2021] Intensive Training</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share A (not so deep) Dive into Grafana CVE-2021-43798 on twitter" href="https://twitter.com/intent/tweet/?text=A%20%28not%20so%20deep%29%20Dive%20into%20Grafana%20CVE-2021-43798&url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f&hashtags=writeups"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share A (not so deep) Dive into Grafana CVE-2021-43798 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f&title=A%20%28not%20so%20deep%29%20Dive%20into%20Grafana%20CVE-2021-43798&summary=A%20%28not%20so%20deep%29%20Dive%20into%20Grafana%20CVE-2021-43798&source=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share A (not so deep) Dive into Grafana CVE-2021-43798 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f&title=A%20%28not%20so%20deep%29%20Dive%20into%20Grafana%20CVE-2021-43798"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share A (not so deep) Dive into Grafana CVE-2021-43798 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share A (not so deep) Dive into Grafana CVE-2021-43798 on whatsapp" href="https://api.whatsapp.com/send?text=A%20%28not%20so%20deep%29%20Dive%20into%20Grafana%20CVE-2021-43798%20-%20https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share A (not so deep) Dive into Grafana CVE-2021-43798 on telegram" href="https://telegram.me/share/url?text=A%20%28not%20so%20deep%29%20Dive%20into%20Grafana%20CVE-2021-43798&url=https%3a%2f%2fnusgreyhats.org%2fposts%2fwriteups%2fa-not-so-deep-dive-in-to-grafana-cve-2021-43798%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://nusgreyhats.org/>NUS Greyhats</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"),document.getElementById("logo").src="/greyhats.png"):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"),document.getElementById("logo").src="/greyhats-dark.png")})</script></body></html>