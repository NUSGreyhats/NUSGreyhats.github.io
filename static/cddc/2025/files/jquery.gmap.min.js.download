!function(t){t.fn.gMap=function(e,o){switch(e){case"addMarker":return t(this).trigger("gMap.addMarker",[o.latitude,o.longitude,o.content,o.icon,o.popup]);case"centerAt":return t(this).trigger("gMap.centerAt",[o.latitude,o.longitude,o.zoom]);case"clearMarkers":return t(this).trigger("gMap.clearMarkers")}var m=t.extend({},t.fn.gMap.defaults,e);return this.each(function(){var l=new google.maps.Map(this);t(this).data("gMap.reference",l);var e=new google.maps.Geocoder;m.address?e.geocode({address:m.address},function(e,o){e&&e.length&&l.setCenter(e[0].geometry.location)}):m.latitude&&m.longitude?l.setCenter(new google.maps.LatLng(m.latitude,m.longitude)):t.isArray(m.markers)&&0<m.markers.length?m.markers[0].address?e.geocode({address:m.markers[0].address},function(e,o){e&&0<e.length&&l.setCenter(e[0].geometry.location)}):l.setCenter(new google.maps.LatLng(m.markers[0].latitude,m.markers[0].longitude)):l.setCenter(new google.maps.LatLng(34.885931,9.84375)),l.setZoom(m.zoom),l.setMapTypeId(google.maps.MapTypeId[m.maptype]);var o={scrollwheel:m.scrollwheel,disableDoubleClickZoom:!m.doubleclickzoom};!1===m.controls?t.extend(o,{disableDefaultUI:!0}):0!==m.controls.length&&t.extend(o,m.controls,{disableDefaultUI:!0}),l.setOptions(o);var d=new google.maps.Marker,o=new google.maps.MarkerImage(m.icon.image);o.size=new google.maps.Size(m.icon.iconsize[0],m.icon.iconsize[1]),o.anchor=new google.maps.Point(m.icon.iconanchor[0],m.icon.iconanchor[1]),d.setIcon(o),m.icon.shadow&&((o=new google.maps.MarkerImage(m.icon.shadow)).size=new google.maps.Size(m.icon.shadowsize[0],m.icon.shadowsize[1]),o.anchor=new google.maps.Point(m.icon.shadowanchor[0],m.icon.shadowanchor[1]),d.setShadow(o)),t(this).bind("gMap.centerAt",function(e,o,a,n){n&&l.setZoom(n),l.panTo(new google.maps.LatLng(parseFloat(o),parseFloat(a)))});var c,a,p=[];t(this).bind("gMap.clearMarkers",function(){for(;p[0];)p.pop().setMap(null)}),t(this).bind("gMap.addMarker",function(e,o,a,n,s,t){var r,i=new google.maps.LatLng(parseFloat(o),parseFloat(a)),g=new google.maps.Marker({position:i});s?((i=new google.maps.MarkerImage(s.image)).size=new google.maps.Size(s.iconsize[0],s.iconsize[1]),i.anchor=new google.maps.Point(s.iconanchor[0],s.iconanchor[1]),g.setIcon(i),s.shadow&&((i=new google.maps.MarkerImage(s.shadow)).size=new google.maps.Size(s.shadowsize[0],s.shadowsize[1]),i.anchor=new google.maps.Point(s.shadowanchor[0],s.shadowanchor[1]),d.setShadow(i))):(g.setIcon(d.getIcon()),g.setShadow(d.getShadow())),n&&("_latlng"===n&&(n=o+", "+a),r=new google.maps.InfoWindow({content:m.html_prepend+n+m.html_append}),google.maps.event.addListener(g,"click",function(){c&&c.close(),r.open(l,g),c=r}),t&&google.maps.event.addListenerOnce(l,"tilesloaded",function(){r.open(l,g)})),g.setMap(l),p.push(g)});for(var n=this,s=0;s<m.markers.length;s++)(a=m.markers[s]).address?("_address"===a.html&&(a.html=a.address),e.geocode({address:a.address},function(a){return function(e,o){e&&0<e.length&&t(n).trigger("gMap.addMarker",[e[0].geometry.location.lat(),e[0].geometry.location.lng(),a.html,a.icon,a.popup])}}(a))):t(this).trigger("gMap.addMarker",[a.latitude,a.longitude,a.html,a.icon,a.popup])})},t.fn.gMap.defaults={address:"",latitude:0,longitude:0,zoom:1,markers:[],controls:[],scrollwheel:!1,doubleclickzoom:!0,maptype:"ROADMAP",html_prepend:'<div class="gmap_marker">',html_append:"</div>",icon:{image:"http://www.google.com/mapfiles/marker.png",shadow:"http://www.google.com/mapfiles/shadow50.png",iconsize:[20,34],shadowsize:[37,34],iconanchor:[9,34],shadowanchor:[6,34]}}}(jQuery);